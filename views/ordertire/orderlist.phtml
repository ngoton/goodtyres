<link href="<?php echo BASE_URL ?>/public/css/jquery.tagit.css" rel="stylesheet" type="text/css">
<link href="<?php echo BASE_URL ?>/public/css/tagit.ui-zendesk.css" rel="stylesheet" type="text/css">
<script src="<?php echo BASE_URL ?>/public/js/tag-it.js" type="text/javascript" charset="utf-8"></script>
<?php
$url_order = 'ASC';
if ($order_by == 'order_tire_id')
    $url_order = $order == 'ASC' ? 'DESC' : 'ASC';
elseif ($order_by == 'order_tire_date')
    $url_order = $order == 'ASC' ? 'DESC' : 'ASC';
elseif ($order_by == 'customer_name')
    $url_order = $order == 'ASC' ? 'DESC' : 'ASC';
elseif ($order_by == 'total')
    $url_order = $order == 'ASC' ? 'DESC' : 'ASC';
elseif ($order_by == 'order_tire_number')
    $url_order = $order == 'ASC' ? 'DESC' : 'ASC';


    $k = $sonews*$page-($sonews-1);

?>

<div id="loading"></div>
<div id="winpopup"></div>

<div id="content" style="padding:5px;">
    <center style="clear:both;margin-bottom: -30px;"><h1> DANH SÁCH ĐƠN HÀNG </h1></center>
<div class="add-box">
    <a class="add_button" href="<?php echo $this->url('ordertire') ?>">Thêm đơn hàng mới</a>
    <?php if($_SESSION['role_logined'] ==1 ){ ?>
    <a class="add_button" id="btnExport" >Export Excel</a>
    <?php } ?>
</div>
	<div class="search-box">
        
        <input type="search" id="search-input" name="s" value="<?php echo isset($keyword)?$keyword:null; ?>" placeholder="Tìm kiếm">
        <input type="button" name="" id="search-submit" class="button-search" value="Tìm kiếm" onclick="searchall('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');">
    </div>
    <div class="tablenav top">
        <div >
            <select id="sl_tha" name="sl_tha" style="width:90px; margin-left:5px;">
             <?php 
                for ($i=1; $i < 13; $i++) { 
                    echo '<option value="'.$i.'">Tháng '.$i.'</option>';
                }
             ?>
            </select>
            <select id="sl_na" name="sl_na" style="width:100px">
             <?php 
                $nam = date('Y');
                for ($i=($nam-5); $i < ($nam+5); $i++) { 
                    echo '<option value="'.$i.'">Năm '.$i.'</option>';
                }
             ?>
            </select>
            <input type="button" name="" id="search" class="button-search" value="Xem" onclick="searchall('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');">
        </div>
        <div >
    
            Từ  <input style="width:100px" type="search" name="batdau" id="batdau" placeholder="Chọn ngày" <?php if(isset($batdau)) echo "value='$batdau'"; ?> >  
            Đến  <input style="width:100px" type="search" name="ketthuc" id="ketthuc" placeholder="Chọn ngày" <?php if(isset($ketthuc)) echo "value='$ketthuc'"; ?> >  
             <input type="button" name="" id="search" class="button-search" value="Xem" onclick="searchall('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');"> 
                                    
        </div>
        
        <div class="add-box">
            <select id="sl_status" name="sl_status" style="width:200px" class="selectpicker" data-show-subtext="true" data-live-search="true">
                <option value="">Khách hàng</option>
                <?php foreach ($customers as $customer) { ?>
                    <option value="<?php echo $customer->customer_id ?>"><?php echo $customer->customer_name ?></option>
                <?php } ?>
            </select>
            <input type="button" name="" id="search" class="button-search" value="Xem" onclick="searchall('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');">
        </div>
        <div class="add-box">
            <select id="sl_nv" name="sl_nv" style="width:150px">
                <option value="">Trạng thái</option>
                <option value="0">Chưa giao hàng</option>
                <option value="1">Đã giao hàng</option>
            </select>
            <input type="button" name="" id="search" class="button-search" value="Xem" onclick="searchall('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');">
        </div>
    	<div class="alignleft actions">
			<select name="action" id="action">
            	<option value="-1" selected="selected">Chọn</option>
                <?php if($_SESSION['role_logined'] == 1 || $_SESSION['role_logined'] == 3 || $_SESSION['role_logined'] == 9){ ?>
                <option value="delete">Xóa</option>
                <?php } ?>
            </select>
            <input type="button" name="" id="doaction" class="button action" value="Áp dụng" onclick="action2();">
		</div>
		<div class="alignleft actions">
		<select name="m" id="chonloc">
			<option  value="18446744073709">Hiển thị tất cả</option>
            <option selected="selected" value="10">Hiển thị 10 giá trị</option>
			<option value="20">Hiển thị 20 giá trị</option>
            <option value="30">Hiển thị 30 giá trị</option>
            <option value="50">Hiển thị 50 giá trị</option>
            
		</select>
		<input type="button" name="" id="post-query-submit" class="button" value="Chọn lọc" onclick="searchall('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');">						 		
        </div>

      </div>
    

</div>

<table id="tblExport" class="table_data">
<thead>
    <tr>
    	<th rowspan="2" class="fix"><input type="checkbox" onclick="checkall('checkbox', this)" name="checkall"/></th>
        <th rowspan="2" class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','order_tire_id','<?php echo $url_order ?>')">STT <?php if ($order_by == 'order_tire_id'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th>
        <th  class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','order_number','<?php echo $url_order ?>')">Số đơn hàng <?php if ($order_by == 'order_number'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th>
        <th  class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','customer_name','<?php echo $url_order ?>')">Khách hàng <?php if ($order_by == 'customer_name'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th>
        <th  class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','order_tire_number','<?php echo $url_order ?>')">SL <?php if ($order_by == 'order_tire_number'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th>
        <th  class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','total','<?php echo $url_order ?>')">Thu <?php if ($order_by == 'total'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th>
        <th  class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','vat','<?php echo $url_order ?>')">Thuế GTGT <?php if ($order_by == 'vat'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th>
        <th  class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','discount','<?php echo $url_order ?>')">Trừ giảm <?php if ($order_by == 'discount'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th>
        
        <th class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','total','<?php echo $url_order ?>')">KH phải trả <?php if ($order_by == 'total'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th>
        <th class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','order_cost','<?php echo $url_order ?>')">Chi phí <?php if ($order_by == 'order_cost'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th> 
        
        <th class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','username','<?php echo $url_order ?>')">Sale <?php if ($order_by == 'username'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th> 
        <th class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','approve','<?php echo $url_order ?>')">Duyệt <?php if ($order_by == 'approve'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th> 
        <th class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','order_tire_status','<?php echo $url_order ?>')">Trạng thái <?php if ($order_by == 'order_tire_status'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th> 
        <th class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','delivery_date','<?php echo $url_order ?>')">Ngày giao <?php if ($order_by == 'delivery_date'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th> 
        <th class="fix">
            <a class="sort <?php echo $order ?>" onclick="sapxep('<?php echo $page ?>','due_date','<?php echo $url_order ?>')">Hạn TT <?php if ($order_by == 'due_date'): ?><i class="icon-chevron-<?php echo $url_order == 'ASC' ? 'down' : 'up' ?>"></i><?php endif; ?></a>
        </th> 
        <th  class="fix">&nbsp;</th>
    </tr>
    
   </thead>
   <tbody>
    <?php $tongsl = 0; $tongthu=0; $tongthue=0; $tonggiam=0; $tongtra=0; $tongchiphi=0; ?>
    <?php foreach ($order_tires as $order_tire) : ?>
    <?php
        $tongsl += $order_tire->order_tire_number; 
        $tongthu += $order_tire->total-$order_tire->vat+$order_tire->discount+$order_tire->reduce; 
        $tongthue += $order_tire->vat; 
        $tonggiam += $order_tire->discount+$order_tire->reduce; 
        $tongtra += $order_tire->total;
        $tongchiphi += $order_tire->order_cost;

        $giaban = $order_tire_discount[$order_tire->order_tire_id]['thu'];
        $giacongkhai = $order_tire_discount[$order_tire->order_tire_id]['gia'];
        $giam = round((($giacongkhai-$giaban)/$giacongkhai)*100,1);

        if ($this_month[$order_tire->order_tire_id]<20) {
            $phantram = 10;
        }
        else if ($this_month[$order_tire->order_tire_id]>=20 && $this_month[$order_tire->order_tire_id]<40) {
            $phantram = 12;
        }
        else if ($this_month[$order_tire->order_tire_id]>=40 && $this_month[$order_tire->order_tire_id]<60) {
            $phantram = 14;
        }
        else if ($this_month[$order_tire->order_tire_id]>=60 && $this_month[$order_tire->order_tire_id]<80) {
            $phantram = 16;
        }
        else if ($this_month[$order_tire->order_tire_id]>=80 && $this_month[$order_tire->order_tire_id]<100) {
            $phantram = 18;
        }
        else if ($this_month[$order_tire->order_tire_id]>=100 && $this_month[$order_tire->order_tire_id]<120) {
            $phantram = 20;
        }
        else if ($this_month[$order_tire->order_tire_id]>=120 && $this_month[$order_tire->order_tire_id]<150) {
            $phantram = 21;
        }
        else if ($this_month[$order_tire->order_tire_id]>=150 && $this_month[$order_tire->order_tire_id]<180) {
            $phantram = 22;
        }
        else if ($this_month[$order_tire->order_tire_id]>=180 && $this_month[$order_tire->order_tire_id]<220) {
            $phantram = 23;
        }
        else{
            $phantram = 24;
        }

        $lech = $giam-$phantram;
        $color = "";
        if ($lech>2 && $lech<=4) {
            $color = "#f7f7bad6";
        }
        else if ($lech>4) {
            $color = "#f94e4e85";
        }

        $tru = $order_tire->order_cost;

        if ($order_tire->order_tire_number>49) {
            $tru = $tru-$order_tire->order_cost;
        }

        $luongsp = $salary[$order_tire->order_tire_id];
        $luongsp = $luongsp-$tru;
        if ($luongsp<$arr_salary['sanluong']*$order_tire->order_tire_number) {
            $luongsp = $arr_salary['sanluong']*$order_tire->order_tire_number;
        }
    ?>
        <tr onClick="HighLightTR(this,'#4d90fe','cc3333');" id="<?php echo $order_tire->order_tire_id ?>" class="edit_tr" data="<?php echo ($order_tire->sale==$_SESSION['userid_logined'] || $_SESSION['role_logined']==1)?1:0 ?>" <?php echo $color!=""?'style="background:'.$color.'"':null ?> >
        	<td><input name="check[]" type="checkbox" class="checkbox" value="<?php echo $order_tire->order_tire_id ?>"></td>
            <td class="fix"><?php echo $k++; ?></td>
            <td class="fix masterTooltip"  id="order_number_<?php echo $order_tire->order_tire_id; ?>" <?php echo 'title="Lương SP: '.$lib->formatMoney($luongsp).'"'; ?> >
                <?php 
                if($order_tire->order_number != ""){ ?>
                    <a style="font-weight:bold;text-decoration:underline" class="order_number" data="<?php echo $order_tire->order_tire_id; ?>">
                        <?php echo $order_tire->order_number;  ?>
                    </a>
                <?php }
                else
                    echo '<button class="order_number" data="'.$order_tire->order_tire_id.'">Số ĐH</button>';
                ?>
            </td>
            <td class="fix" data="<?php echo $order_tire->customer; ?>"  id="customer_<?php echo $order_tire->order_tire_id; ?>"><a target="_blank" href="<?php echo $this->url('customer/index/'.$order_tire->customer); ?>"><?php echo $order_tire->customer_name; ?></a> <br><a  style="font-weight:bold;text-decoration:underline" data="<?php echo $order_tire->customer ?>" value="1"  class="editButton"><i class="fa fa-file-text-o"></i> Hợp đồng</a> 
                <?php if(($order_tire->sale_lock!=1 && ($order_tire->sale==$_SESSION['userid_logined'] || $order_tire->sale_cskh==$_SESSION['userid_logined'])) || $_SESSION['role_logined']==1 || $_SESSION['role_logined']==3){ ?>
                <a title="Chuyển" style="font-weight:bold;text-decoration:underline" data="<?php echo $order_tire->order_tire_id ?>" value="<?php echo $order_tire->customer ?>" class="editCustomer"><i class="fa fa-mail-forward"></i></a>
                <?php } ?>
            </td>
            <td class="fix masterTooltip text-right"  id="order_tire_number_<?php echo $order_tire->order_tire_id; ?>" <?php echo 'title="Tháng trước: '.$last_month[$order_tire->order_tire_id].' Tháng này: '.$this_month[$order_tire->order_tire_id].' Giảm giá '.$giam.'%"'; ?> ><a style="font-weight:bold;text-decoration:underline" class="order_list" href="<?php echo $this->url('ordertire/listtire/'.$order_tire->order_tire_id); ?>"><?php echo $order_tire->order_tire_number; ?></a></td>
            <td class="fix text-right" id="thu_<?php echo $order_tire->order_tire_id; ?>"><?php echo $lib->formatMoney($order_tire->total-$order_tire->vat+$order_tire->discount+$order_tire->reduce); ?></td> 
            <td class="fix text-right"  id="vat_<?php echo $order_tire->order_tire_id; ?>">
                <b>
                <a class="order_vat" tabindex="<?php echo $lib->formatMoney($order_tire->vat_percent); ?>" alt="<?php echo $lib->formatMoney($order_tire->check_price_vat>0?($order_tire->total+$order_tire->discount+$order_tire->reduce):($order_tire->total-$order_tire->vat+$order_tire->discount+$order_tire->reduce)); ?>" title="<?php echo $order_tire->check_price_vat>0?1:0; ?>" value="<?php echo $order_tire->sale_lock ?>" data="<?php echo $order_tire->order_tire_id; ?>"><?php echo $lib->formatMoney($order_tire->vat); ?></a>
                </b>
                <br>
                <a style="text-decoration:underline" class="vat_list" data="<?php echo $order_tire->order_tire_id ?>" ><i class="fa fa-file-text-o"></i> HĐ</a>
            </td>
            <td class="fix text-right"  id="discount_<?php echo $order_tire->order_tire_id; ?>">
                <a class="order_discount" href="<?php echo $this->url('ordertire/listdiscount/'.$order_tire->order_tire_id.'/'.$order_tire->sale_lock); ?>" ><?php echo $lib->formatMoney($order_tire->discount+$order_tire->reduce); ?></a>
            </td>
            <td class="fix masterTooltip text-right"  id="total_<?php echo $order_tire->order_tire_id; ?>" <?php echo 'title="Giảm giá '.$giam.'%"'; ?> ><?php echo $lib->formatMoney($order_tire->total); ?><br>
                <a style="text-decoration:underline" class="customer" href="<?php echo $this->url('tiredebit/customer/'.$order_tire->customer.'/'.strtotime(date('d-m-Y'))); ?>"><i class="fa fa-search-plus"></i>Công nợ</a></td>
            <td class="fix text-right"  id="order_cost_<?php echo $order_tire->order_tire_id; ?>">
                <?php if($order_tire->order_cost != ""){ ?>
                <a style="font-weight:bold;text-decoration:underline" class="order_cost" data="<?php echo $order_tire->order_tire_id; ?>" alt="<?php echo $order_tire->order_tire_status==1?(strtotime(date('t-m-Y',$order_tire->delivery_date))+691200):(strtotime(date('t-m-Y'))+691200); ?>" >
                    <?php echo $lib->formatMoney($order_tire->order_cost); ?>
                </a>
                <?php } else{ ?>
                <button class="order_cost" data="<?php echo $order_tire->order_tire_id ?>" alt="<?php echo $order_tire->order_tire_status==1?(strtotime(date('t-m-Y',$order_tire->delivery_date))+691200):(strtotime(date('t-m-Y'))+691200); ?>" >Thêm CP</button>
                <?php } ?>
            </td>
            <td class="fix" id="sale_<?php echo $order_tire->order_tire_id; ?>">
                <?php if(($order_tire->sale_lock!=1 && ($order_tire->sale==$_SESSION['userid_logined'] || $order_tire->sale_cskh==$_SESSION['userid_logined'])) || $_SESSION['role_logined']==1 || $_SESSION['role_logined']==3  || $_SESSION['role_logined']==2){ ?>
                <a data="<?php echo $order_tire->order_tire_id ?>" value="<?php echo $order_tire->sale ?>"  class="change_sale"><?php echo $order_tire->username; ?></a>
                <?php }
                else{
                    echo $order_tire->username;
                }
                 ?>
            </td> 
            <td class="fix masterTooltip" id="approve_<?php echo $order_tire->order_tire_id; ?>" data="<?php echo $order_tire->approve; ?>" <?php echo 'title="Giảm giá '.$giam.'%"'; ?> >
                <?php if (isset($users['name'][$order_tire->approve])) {
                    echo $users['name'][$order_tire->approve];
                    if ($order_tire->order_tire_status!=1 && ($_SESSION['userid_logined']==$order_tire->approve || $_SESSION['role_logined']==1)) {
                        echo '<br><button style="display:none" id="approve_btn_'.$order_tire->order_tire_id.'" data="'.$order_tire->order_tire_id.'" class="approveremove">Hủy</button>';
                    }
                }
                else if(($_SESSION['role_logined']==1 || $_SESSION['role_logined']==9 || $_SESSION['role_logined']==3 || $_SESSION['role_logined']==2)){ 
                    echo '<button data="'.$order_tire->order_tire_id.'" class="approve">Duyệt</button>';
                } ?>
            </td>  
            <td class="fix" id="order_tire_status_<?php echo $order_tire->order_tire_id; ?>" data="<?php echo $order_tire->order_tire_status ?>">
                <?php
                if ($order_tire->order_tire_status==1) {
                ?>
                    <a style="font-weight:bold;text-decoration:underline" class="ex_stock_edit" alt="<?php echo date('d-m-Y',$order_tire->delivery_date); ?>" title="<?php echo date('d-m-Y',$order_tire->arrival_date); ?>" name="<?php echo isset($lift[$order_tire->order_tire_id])?$lift[$order_tire->order_tire_id]:null; ?>" data="<?php echo $order_tire->order_tire_id; ?>">
                        Đã giao
                    </a>
                <?php
                }
                else{
                 if (isset($users['name'][$order_tire->approve])){ ?>
                <button id="ex_stock_<?php echo $order_tire->order_tire_id; ?>" style="display:none" class="ex_stock" data="<?php echo $order_tire->order_tire_id; ?>">Xuất kho</button>
                <?php }  } ?>
            </td> 
            <td class="fix"  id="delivery_date_<?php echo $order_tire->order_tire_id; ?>">
                <?php 
                $de_date = $order_tire->delivery_date>0?$lib->hien_thi_ngay_thang($order_tire->delivery_date):null; 
                if ($order_tire->order_tire_status!=1) { ?>
                    <a data="<?php echo $order_tire->order_tire_id ?>" value="<?php echo $de_date ?>"  class="change_delivery"><?php echo $de_date; ?></a>
                <?php }
                else{
                    echo $de_date;
                }
                ?>
                    
            </td>
            <td class="fix"  id="due_date_<?php echo $order_tire->order_tire_id; ?>">
                <?php 
                $due_date = $order_tire->due_date>0?$lib->hien_thi_ngay_thang($order_tire->due_date):null;
                if(($order_tire->sale_lock!=1 && ($order_tire->sale==$_SESSION['userid_logined'] || $order_tire->sale_cskh==$_SESSION['userid_logined'])) || $_SESSION['role_logined']==1 || $_SESSION['role_logined']==3){ ?>
                <a data="<?php echo $order_tire->order_tire_id ?>" value="<?php echo $due_date ?>"  class="change_due"><?php echo $due_date; ?></a>
                <?php }
                else{
                    echo $due_date;
                }
                 ?>
            </td>
            <td class="fix">  
            <div  > 
                <?php if ($order_tire->approve>0) { ?>
                <button class="bienban" data="<?php echo $order_tire->order_tire_id ?>">BBBG</button>
                <button onClick="javascript:window.location.href='<?php echo BASE_URL.'/ordertire/bill/'.$order_tire->order_tire_id ?>'">PGN</button>
                <?php } ?>
                <?php if($order_tire->sale_lock==1 && ($_SESSION['role_logined']==1 || $_SESSION['role_logined']==9 || $_SESSION['role_logined']==3)){ ?>
                <button data="<?php echo $order_tire->order_tire_id ?>" value="0"  class="unlock">Mở</button>
                <?php }elseif ($order_tire->sale_lock!=1 && ($_SESSION['role_logined']==1 || $_SESSION['role_logined']==9 || $_SESSION['role_logined']==3)) { ?>
                    <button data="<?php echo $order_tire->order_tire_id ?>" value="1"  class="unlock">Khóa</button>
                <?php } ?>
                <?php if(($order_tire->sale_lock!=1 && ($order_tire->sale==$_SESSION['userid_logined'] || $order_tire->sale_cskh==$_SESSION['userid_logined'])) || $_SESSION['role_logined']==1){ ?>
                <a class="error revert" data="<?php echo $order_tire->order_tire_id ?>" >Hủy</a>
                <a class="error del" data="<?php echo $order_tire->order_tire_id ?>" >Xóa</a>
                <?php } ?>
            </div>
            </td>
        </tr>
    <?php endforeach; ?>
        <tr style="text-align:center; font-weight: bold; color: red;">
            <td class="fix" colspan="4" >Tổng cộng</td>
            <td class="fix text-right"><?php echo $lib->formatMoney($tongsl); ?></td>
            <td class="fix text-right"><?php echo $lib->formatMoney($tongthu); ?></td>
            <td class="fix text-right"><?php echo $lib->formatMoney($tongthue); ?></td>
            <td class="fix text-right"><?php echo $lib->formatMoney($tonggiam); ?></td>
            <td class="fix text-right"><?php echo $lib->formatMoney($tongtra); ?></td>
            <td class="fix text-right"><?php echo $lib->formatMoney($tongchiphi); ?></td>
            <td class="fix" colspan="6" ></td>
        </tr>

   </tbody>
</table>
<?php
$this->helper('slidePaginator');
?>
<div id="hoanthanh"><input type="hidden" id="lastID"></div><!-- /.modal -->
<div class="goback" style="margin: 0 auto"><a href="<?php echo $this->url('ordertire/orderlist') ?>">&larr;</a></div>

<div id="dialogContent" title="Mã đơn hàng">
    
    
    <form action="#" method="post" id="editForm">
        
        
        <label>
            <span class="add-on"><i class="icon-retweet" ></i></span>
            <span>Số đơn hàng: </span>
            <input type="text" id="i_order_number" name="i_order_number" value="" required="required" />
            <input type="hidden" id="i_order" name="i_order" value="" required="required" />
        </label>
        
    </form>
</div>

<div id="dialogContent5" title="VAT">
    
    
    <form action="#" method="post" id="editForm5">
        
        
        <label>
            <span class="add-on"><i class="icon-retweet" ></i></span>
            <span>VAT(%): </span> <br>
            <input type="text" id="i_vat_percent" name="i_vat_percent" value="" required="required" />
            <input type="hidden" id="i_order5" name="i_order5" value="" required="required" />
            <input type="hidden" id="i_thu" name="i_thu" value="" required="required" />
            <input type="checkbox" id="i_check_vat" name="i_check_vat" value="" > bao VAT
        </label>
        <label>
            <span class="add-on"><i class="icon-ok-circle" ></i></span>
            <span>VAT: </span> <br>
            <input type="text" class="numbers" id="i_vat" name="i_vat" value="" required="required" />
        </label>
        
    </form>
</div>

<div id="dialogContent3" title="Xuất kho">
    
    
    <form action="#" method="post" id="editForm3">
        
        
        <label>
            <span class="add-on"><i class="icon-calendar" ></i></span>
            <span>Ngày giao hàng: </span>
            <input type="text" id="i_delivery_date" name="i_delivery_date" class="ngay" value="" required="required" />
            <input type="hidden" id="i_order3" name="i_order3" value="" required="required" />
        </label>
        <label>
            <span class="add-on"><i class="icon-calendar" ></i></span>
            <span>Ngày nhận hàng: </span>
            <input type="text" id="i_arrival_date" name="i_arrival_date" class="ngay" value="" required="required" />
        </label>
        <label>
            <span class="add-on"><i class="icon-user" ></i></span>
            <span>NV bốc xếp: </span>
            <input type="text" id="i_lift" name="i_lift"  />
            <ul id="mytags"></ul>
        </label>
        
    </form>
</div>

<div id="dialogContent6" title="Xuất kho">
    
    
    <form action="#" method="post" id="editForm6">
        
        
        <label>
            <span class="add-on"><i class="icon-calendar" ></i></span>
            <span>Ngày giao hàng: </span>
            <input type="text" id="i_delivery_date6" name="i_delivery_date6" class="ngay" required="required" />
            <input type="hidden" id="i_order6" name="i_order6"  required="required" />
        </label>
        <label>
            <span class="add-on"><i class="icon-calendar" ></i></span>
            <span>Ngày nhận hàng: </span>
            <input type="text" id="i_arrival_date6" name="i_arrival_date6" class="ngay" required="required" />
        </label>
        <label>
            <span class="add-on"><i class="icon-user" ></i></span>
            <span>NV bốc xếp: </span>
            <input type="text" id="i_lift6" name="i_lift6"  />
            <ul id="mytags"></ul>
        </label>
        
    </form>
</div>

<div id="dialogContent2" title="Chi phí đơn hàng">
    
    
    <form action="#" method="post" id="editForm2">
        
        <input type="hidden" id="i_order2" name="i_order2" value="" required="required" />
        <table id="dataTable" border="1" style="width: 100%; border: 1px solid rgb(221, 217, 217); margin-bottom: 10px" >
            <tbody>
                <?php if( !isset($vendor_data) || count($vendor_data) == 0){ ?>
                <tr>
                    <td><input type="checkbox" name="chk"></td>
                    <td>
                        <table style="width: 100%">
                            <tr>
                                <td></td>
                                <td>Loại chi phí</td>
                                <td>
                                    <select tabindex="1" class="order_tire_cost_type" name="order_tire_cost_type[]" style="width:100px">
                                        <option value="1">Trucking</option>
                                        <option value="2">Barging</option>
                                        <option value="3">Feeder</option>
                                        <option value="4">Thu hộ</option>
                                        <option value="5">Hoa hồng</option>
                                        <option value="6">TTHQ</option>
                                        <option value="7">Khác</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    Vendor
                                </td>
                                <td>
                                    <input type="text" class="vendor" name="vendor[]" required="required" autocomplete="off" placeholder="Nhập tên hoặc * để chọn"> <a style="font-size: 24px; font-weight: bold; color:red" title="Thêm mới" target="_blank" href="<?php echo $this->url('shipmentvendor') ?>"> + </a>
                                    <ul class="customer_list_id"></ul>
                                    <select tabindex="2" class="vendor" name="vendor[]" style="width:200px">
                                        <?php foreach ($vendor_list as $vendor) { ?>
                                        <?php
                                            if ($vendor->vendor_type == 1) {
                                                $type = "TTHQ";
                                            }
                                            else if ($vendor->vendor_type == 2) {
                                                $type = "Trucking";
                                            }
                                            else if ($vendor->vendor_type == 3) {
                                                $type = "Barging";
                                            }
                                            else if ($vendor->vendor_type == 4) {
                                                $type = "Feeder";
                                            }
                                            else if ($vendor->vendor_type == 5) {
                                                $type = "Hoa hồng";
                                            }
                                            else if ($vendor->vendor_type == 6) {
                                                $type = "Thu hộ";
                                            }
                                            else if ($vendor->vendor_type == 7) {
                                                $type = "Khác";
                                            }
                                        ?>
                                        <option class="<?php echo $vendor->vendor_type ?>" value="<?php echo $vendor->shipment_vendor_id ?>"><?php echo $vendor->shipment_vendor_name ?></option>
                                        <?php } ?>
                                    </select>
                                    <a style="font-size: 24px; font-weight: bold; color:red" title="Thêm mới" target="_blank" href="<?php echo $this->url('shipmentvendor') ?>"> + </a>
                                </td>
                                <td>
                                    Ngày chi
                                </td>
                                <td>
                                    <input tabindex="5" class="order_tire_cost_date" type="date"   name="order_tire_cost_date[]" >
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    Số tiền
                                </td>
                                <td>
                                    <input tabindex="3" type="text" style="width:120px" class="numbers order_tire_cost"  name="order_tire_cost[]"  >
                                </td>
                                <td>
                                    Nội dung
                                </td>
                                <td rowspan="2">
                                    <textarea tabindex="10" class="comment" name="comment[]" ></textarea>
                                </td>
                            </tr>
                            
                        </table>
                    </td>
                </tr>
                <?php } ?>
                

                

            </tbody>
        </table>

        <input type="hidden" id="check_date">

        <input type="button" value="Thêm chi phí khác" onclick="addRow('dataTable')">

        <input type="button" value="Xóa chi phí" onclick="deleteRow('dataTable')">
        
    </form>
</div>

<div id="dialogContent4" title="Hợp đồng">
    
    
    <form action="#" method="post" id="editForm">
        <label>
            <input type="hidden" id="contract_link" name="contract_link" value="" />
            <input type="hidden" id="contract_customer" name="contract_customer" value="" />
            <span class="add-on"><i class="icon-calendar" ></i></span>
            <span>Ngày: </span> <br>
            <input type="text" id="contract_date" name="contract_date" value="" class="ngay" required="required" />
        </label>
        <label>
            <span class="add-on"><i class="icon-ok-circle" ></i></span>
            <span>Số hợp đồng: </span> <br>
            <input type="text" id="contract_number" name="contract_number" value="" required="required" />
        </label>
        
        <label>
            <span class="add-on"><i class="icon-retweet" ></i></span>
            <span>Phương thức thanh toán (%): </span> <br>
            Đợt 1: <input type="text" id="contract_pay" name="contract_pay" value="" required="required" /> <br>
            Đợt 2: <input type="text" id="contract_pay2" name="contract_pay2" value="" required="required" />
        </label>
        <label>
            <span class="add-on"><i class="icon-calendar" ></i></span>
            <span>Hiệu lực: </span> <br>
            <input type="text" id="contract_valid" name="contract_valid" value="" class="ngay" required="required" />
        </label>
        
    </form>
</div>

<div id="dialogContent7" title="Hóa đơn lô hàng">
    
    
    <form action="#" method="post" id="editForm3">
        
        <input type="hidden" id="i_order7" name="i_order7" value="" required="required" />
        <table id="dataTable2" border="1" style="width: 100%; border: 1px solid rgb(221, 217, 217); margin-bottom: 10px" >
            <tbody>
                <?php if( !isset($vat_data) || count($vat_data) == 0){ ?>
                <tr>
                    <td><input type="checkbox" name="ch2"></td>
                    <td>
                        <table style="width: 100%">
                            <tr>
                                <td></td>
                                <td>
                                    Số hóa đơn
                                </td>
                                <td>
                                    <input tabindex="1" type="text" style="width:120px" class="number invoice_tire_number"  name="invoice_tire_number[]"  >
                                </td>
                                <td>
                                    Ngày hóa đơn
                                </td>
                                <td>
                                    <input tabindex="2" class="invoice_tire_date" type="date"   name="invoice_tire_date[]" >
                                </td>
                            </tr>
                            
                            
                        </table>
                    </td>
                </tr>
                <?php } ?>
                

                

            </tbody>
        </table>

        <input type="button" value="Thêm hóa đơn khác" onclick="addRow2('dataTable2')">

        <input type="button" value="Xóa hóa đơn" onclick="deleteRow2('dataTable2')">
        
    </form>
</div>
<div id="dialogContent8" title="Nhân viên bán hàng">
    <form action="#" method="post" id="editForm4">
        <select name="order_staff" id="order_staff">
            <?php foreach ($staffs as $staff) { ?>
                <option value="<?php echo $staff->account ?>"><?php echo $staff->staff_name ?></option>
            <?php } ?>
        </select>
        <input type="hidden" id="i_order8" name="i_order8" value="" required="required" />
    </form>
</div>
<div id="dialogContent9" title="Hạn thanh toán">    
    <form action="#" method="post" id="editForm5">
        <label>
            <span class="add-on"><i class="icon-calendar" ></i></span>
            <span>Hạn thanh toán: </span>
            <input type="text" id="i_due_date" name="i_due_date" class="ngay" value="" required="required" />
            <input type="hidden" id="i_order9" name="i_order9" value="" required="required" />
        </label> 
    </form>
</div>
<div id="dialogContent10" title="Khách hàng">
    <form action="#" method="post" id="editForm6">
        <select name="order_customer" id="order_customer">
            <?php foreach ($customers as $customer) { ?>
                <option value="<?php echo $customer->customer_id ?>"><?php echo $customer->customer_name ?></option>
            <?php } ?>
        </select>
        <input type="hidden" id="i_order10" name="i_order10" value="" required="required" />
    </form>
</div>
<div id="dialogContent12" title="Ngày giao">    
    <form action="#" method="post" id="editForm8">
        <label>
            <span class="add-on"><i class="icon-calendar" ></i></span>
            <span>Ngày giao hàng: </span>
            <input type="text" id="i_de_date" name="i_de_date" class="ngay" value="" required="required" />
            <input type="hidden" id="i_order12" name="i_order12" value="" required="required" />
        </label> 
    </form>
</div>

<script type="text/javascript">
var x = "<?php echo $limit ?>";
$('#chonloc option[value='+x+']').attr('selected','selected');

var c = "<?php echo $trangthai ?>";
$('#sl_status option[value='+c+']').attr('selected','selected');

var s = "<?php echo $nv ?>";
$('#sl_nv option[value='+s+']').attr('selected','selected');

var th = "<?php echo $thang ?>";
$('#sl_tha option[value='+th+']').attr('selected','selected');

var n = "<?php echo $nam ?>";
$('#sl_na option[value='+n+']').attr('selected','selected');

$('.change_delivery')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        
        $('#i_order12').val($(this).attr('data'));
        $('#i_de_date').val($(this).attr('value'));
        $( "#dialogContent12" ).dialog( "open" )
    });


//set up the dialog box.
$( "#dialogContent12" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        OK: function() {
            var id = $('#i_order12').val();
            var de_date = $('#i_de_date').val();
                
                $.post("<?php echo BASE_URL ?>/ordertire/changedelivery", {data: id, de_date: de_date},
                   function(data){
                    $("html, body").animate({ scrollTop: 0 }, 100);
                    setTimeout(function() {
                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                      }, 200);
                   
                   }); 
              
            $( this ).dialog( "close" );
        },        
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});
$('.change_due')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        
        $('#i_order9').val($(this).attr('data'));
        $('#i_due_date').val($(this).attr('value'));
        $( "#dialogContent9" ).dialog( "open" )
    });


//set up the dialog box.
$( "#dialogContent9" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        OK: function() {
            var id = $('#i_order9').val();
            var due_date = $('#i_due_date').val();
                
                $.post("<?php echo BASE_URL ?>/ordertire/changedue", {data: id, due_date: due_date},
                   function(data){
                    $("html, body").animate({ scrollTop: 0 }, 100);
                    setTimeout(function() {
                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                      }, 200);
                   
                   }); 
              
            $( this ).dialog( "close" );
        },        
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});

$('.change_sale')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        
        $('#i_order8').val($(this).attr('data'));
        $('#order_staff option[value='+$(this).attr('value')+']').attr('selected','selected');
        $( "#dialogContent8" ).dialog( "open" )
    });


//set up the dialog box.
$( "#dialogContent8" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        OK: function() {
            var id = $('#i_order8').val();
            var order_staff = $('#order_staff').val();
                
                $.post("<?php echo BASE_URL ?>/ordertire/changestaff", {data: id, order_staff: order_staff},
                   function(data){
                    $("html, body").animate({ scrollTop: 0 }, 100);
                    setTimeout(function() {
                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                      }, 200);
                   
                   }); 
              
            $( this ).dialog( "close" );
        },        
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});

$('.editCustomer')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        
        $('#i_order10').val($(this).attr('data'));
        $('#order_customer option[value='+$(this).attr('value')+']').attr('selected','selected');
        $( "#dialogContent10" ).dialog( "open" )
    });


//set up the dialog box.
$( "#dialogContent10" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        OK: function() {
            var id = $('#i_order10').val();
            var order_customer = $('#order_customer').val();
                
                $.post("<?php echo BASE_URL ?>/ordertire/changecustomer", {data: id, order_customer: order_customer},
                   function(data){
                    $("html, body").animate({ scrollTop: 0 }, 100);
                    setTimeout(function() {
                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                      }, 200);
                   
                   }); 
              
            $( this ).dialog( "close" );
        },        
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});


$('.order_number')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        
        $('#i_order').val($(this).attr('data'));

        $.ajax({
            url: '<?php echo BASE_URL ?>/ordertire/getordernumber',
            type: 'GET',
            data: {data:$(this).attr('data')},
            success:function(data){
                $('#i_order_number').val(data);
            }
        });

        $( "#dialogContent" ).dialog( "open" )
    });


//set up the dialog box.
$( "#dialogContent" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        OK: function() {
            var id = $('#i_order').val();
            var order_number = $('#i_order_number').val();
                
                $.post("<?php echo BASE_URL ?>/ordertire/addordernumber", {data: id, order_number: order_number},
                   function(data){
                    $("html, body").animate({ scrollTop: 0 }, 100);
                    setTimeout(function() {
                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                      }, 200);
                   
                   }); 
              
            $( this ).dialog( "close" );
        },        
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});

$('.order_vat')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        
        $('#i_order5').val($(this).attr('data'));
        $('#i_vat').val($(this).text());
        $('#i_vat_percent').val($(this).attr('tabindex'));

        $('#i_thu').val($(this).attr('alt'));
        if ($(this).attr('title')==1) {
          $('#i_check_vat').prop('checked',true)  ;
        }
        else{
            $('#i_check_vat').prop('checked',false)  ;
        }
        

        if ($(this).attr('value') == 1) {
            $('#i_vat').attr('disabled',true);
            $('#i_vat_percent').attr('disabled',true);
            $('#i_check_vat').attr('disabled',true);
        }
        else{
            $('#i_vat').attr('disabled',false);
            $('#i_vat_percent').attr('disabled',false);
            $('#i_check_vat').attr('disabled',false);
        }

        $( "#dialogContent5" ).dialog( "open" );

        $('#i_vat_percent').keyup(function(){
            var val = $(this).val(); 
            var thanhtien = parseInt($('#i_thu').val().replace(/[^0-9\.-]+/g,"")) || 0;

            if ($('#i_check_vat').is(':checked')) {
                var check_vat = 1;
            }
            else{
                var check_vat = 0;
            }
            
            
            if (check_vat>0) {
                $('#i_vat').val(Math.round(thanhtien*val/110));
            }
            else{
                $('#i_vat').val(Math.round(thanhtien*val/100));
            }
            
            
            $('#i_vat').val(function(index, value) {
                return value
                  .replace(/\D/g, "")
                  .replace(/\B(?=(\d{3})+(?!\d))/g, ",")
                ;
            });
        });

        $('#i_vat').keyup(function(){
            var val = parseInt($(this).val().replace(/[^0-9\.-]+/g,""));
            var thanhtien = parseInt($("#i_thu").val().replace(/[^0-9\.-]+/g,""));
            
            if ($('#i_check_vat').is(':checked')) {
                var check_vat = 1;
            }
            else{
                var check_vat = 0;
            }

            if (check_vat>0) {
                $('#i_vat_percent').val(Math.round(val*110/thanhtien));
            }
            else{
                $('#i_vat_percent').val(Math.round(val*100/thanhtien));
            }
            
        });

    });


//set up the dialog box.
$( "#dialogContent5" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        OK: function() {
            var id = $('#i_order5').val();
            var vat_percent = $('#i_vat_percent').val();
            var vat = $('#i_vat').val();
            var thu = $('#i_thu').val();
            if ($('#i_check_vat').is(':checked')) {
                var check_vat = 1;
            }
            else{
                var check_vat = 0;
            }
                
                $.post("<?php echo BASE_URL ?>/ordertire/editvat", {data: id, vat_percent: vat_percent, vat: vat, thu: thu, check_vat:check_vat},
                   function(data){
                    $("html, body").animate({ scrollTop: 0 }, 100);
                    setTimeout(function() {
                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                      }, 200);
                   
                   }); 
              
            $( this ).dialog( "close" );
        },        
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});

$('.order_cost')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        
        $('#i_order2').val($(this).attr('data'));

        $('#check_date').val($(this).attr('alt'));

        $('#dataTable tbody tr').remove();

        $.ajax({
            url: '<?php echo BASE_URL ?>/ordertire/getordercost',
            type: 'POST',
            data: {order_tire:$(this).attr('data')},
            success:function(data){
                //alert(data);
                $('#dataTable tbody').append(data);

                $('.numbers').focus(function(){
                    if ( $(this).val() == '0') {
                       $(this).val(""); 
                    };
                    
                });
                $('.numbers').blur(function(){
                    if ( $(this).val() == "") {
                        $(this).val(0);
                    };
                    
                });
                $('.numbers').keyup(function(event) {

                      // skip for arrow keys
                  if(event.which >= 37 && event.which <= 40) return;

                  // format number
                  $(this).val(function(index, value) {
                    return value
                      .replace(/[^0-9-.]/g, "")
                      .replace(/\B(?=(\d{3})+(?!\d))/g, ",")
                    ;
                  });
                });

                $('html').click(function(e) {
                    $('.customer_list_id').slideUp(200);
                    $('.vendor').each(function(){
                        if ($(this).attr('data')=="") {
                            $(this).val("");
                        }
                    });

                });
                $('.vendor').keyup(function(){
                    var row = $(this).parent().parent().parent().parent().parent().parent();
                    var rowIndex = row[0].rowIndex;

                    var keyword = $(this).val();
                    $.ajax({
                        url: '<?php echo BASE_URL ?>/ordertire/getvendor',
                        type: 'POST',
                        data: {keyword:keyword, offset:rowIndex},
                        success:function(data){
                            $('.customer_list_id:eq('+rowIndex+')').slideDown(200);
                            $('.customer_list_id:eq('+rowIndex+')').html(data);
                        }
                    });
                    if ($('.vendor:eq('+rowIndex+')').val() == "" || $('.vendor:eq('+rowIndex+')').attr('data') == "") {
                        
                        $('.vendor:eq('+rowIndex+')').attr('data',"");
                    }

                    
                });

                $('.vendor').on('keydown', function() {
                    var row = $(this).parent().parent().parent().parent().parent().parent();
                    var rowIndex = row[0].rowIndex;

                    var key = event.keyCode || event.charCode;

                    if( key == 8 || key == 46 ){
                        $('.vendor:eq('+rowIndex+')').attr('data',"");
                    }
                        
                  });
                function set_item_other(item,value,vitri) {
                    // change input value
                    $('.vendor:eq('+vitri+')').val(item);
                    $('.vendor:eq('+vitri+')').attr("data",value);
                    // hide proposition list
                    $('.customer_list_id').hide();
                    $('.vendor:eq('+vitri+')').focus();

                    var check_type = 0;
                    var check_vendor = 0;
                    var val = value;
                    var type_val = $('.order_tire_cost_type:eq('+vitri+')').val();
                        $('.vendor').each(function() { 
                            if (val == $(this).attr('data')) {
                                check_vendor ++;

                                var row2 = $(this).parent().parent().parent().parent().parent().parent();
                                var rowIndex2 = row2[0].rowIndex;
                                var type_val2 = $('.order_tire_cost_type:eq('+rowIndex2+')').val();
                                if (type_val == type_val2) {
                                    check_type ++;
                                }
                            }
                        });


                        if (check_type >= 2 && check_vendor >= 2) {
                            alert('Vui lòng chọn loại phí khác cho vendor này!');
                            $(".order_tire_cost_type:last").val($(".order_tire_cost_type:last option:first").val());
                            //$(".vendor:last").val($(".vendor:last option:first").val());
                            $('.vendor:last').attr('data','');
                            $('.vendor:last').val("");
                            
                        };
                }

                <?php if ($_SESSION['role_logined'] != 1 && $_SESSION['role_logined'] != 9 && $_SESSION['role_logined'] != 3  && $_SESSION['role_logined'] != 2  && $_SESSION['role_logined'] != 8) { ?>
                var today = "<?php echo strtotime(date('d-m-Y')) ?>";
                if (parseInt(today) > parseInt($('#check_date').val())) {
                    $('#editForm2 input').attr('disabled',true);
                    $('.order_tire_cost').attr('disabled',true);
                }
                else{
                    $('#editForm2 input').attr('disabled',false);
                    $('.order_tire_cost').attr('disabled',false);
                }
                <?php } ?>
            
            }
        });

        $("#dialogContent2").dialog({
            draggable:true,
            modal: true,
            autoOpen: false,
            height:500,
            width:"50%",
            
        });

        $( "#dialogContent2" ).dialog( "open" );

        <?php if ($_SESSION['role_logined'] != 1 && $_SESSION['role_logined'] != 9 && $_SESSION['role_logined'] != 3 && $_SESSION['role_logined'] != 2  && $_SESSION['role_logined'] != 8) { ?>
        var today = "<?php echo strtotime(date('d-m-Y')) ?>";
        if (parseInt(today) > parseInt($('#check_date').val())) {
            $('#editForm2 input').attr('disabled',true);
            $('.order_tire_cost').attr('disabled',true);
        }
        else{
            $('#editForm2 input').attr('disabled',false);
            $('.order_tire_cost').attr('disabled',false);
        }
        <?php } ?>
    });


//set up the dialog box.
$( "#dialogContent2" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        OK: function() {
            var id = $('#i_order2').val();
            
            var vendor_cost = [];

            var order_tire_cost_date = [];
            var vendor = [];
            var order_tire_cost = [];
            var comment = [];
            var order_tire_cost_type = [];
            
            var check = 0;

            $('.order_tire_cost_date').each(function() { 
                order_tire_cost_date.push($(this).val());
            });

            $('.vendor').each(function() { 
                var row = $(this).parent().parent().parent().parent().parent().parent();
                var rowIndex = row[0].rowIndex;
                var d = $(this).attr('data') || 0;
                var money = $('.order_tire_cost:eq('+rowIndex+')').val();
                vendor.push(d);

                if (d==0 && money!=0 && money!="") {
                    check++;
                }
            });

            if (check>0) {
                alert("Vui lòng chọn 1 vendor!");
                $('.vendor:last').focus();
                return;
            }

            $('.order_tire_cost').each(function() { 
                order_tire_cost.push($(this).val());
            });
            $('.comment').each(function() { 
                comment.push($(this).val());
            });
            $('.order_tire_cost_type').each(function() { 
                order_tire_cost_type.push($(this).val());
            });
            
            
            for (var i = 0; i < order_tire_cost.length; i++) {
                vendor_cost.push({'order_tire_cost':order_tire_cost[i], 'vendor':vendor[i], 'order_tire_cost_date':order_tire_cost_date[i], 'comment':comment[i], 'order_tire_cost_type':order_tire_cost_type[i]});
                
                
            };
                
                $.post("<?php echo BASE_URL ?>/ordertire/addordercost", {data: id, vendor_cost: vendor_cost},
                   function(data){
                    $("html, body").animate({ scrollTop: 0 }, 100);
                    setTimeout(function() {
                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                      }, 200);
                   
                   }); 
              
            $( this ).dialog( "close" );
        },        
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});

$('.vat_list')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        
        $('#i_order7').val($(this).attr('data'));

        $('#dataTable2 tbody tr').remove();

        $.ajax({
            url: '<?php echo BASE_URL ?>/ordertire/getordervat',
            type: 'POST',
            data: {order_tire:$(this).attr('data')},
            success:function(data){
                //alert(data);
                $('#dataTable2 tbody').append(data);

                $('.number').focus(function(){
                    if ( $(this).val() == '0') {
                       $(this).val(""); 
                    };
                    
                });
                $('.number').blur(function(){
                    if ( $(this).val() == "") {
                        $(this).val(0);
                    };
                    
                });
                $('.number').keyup(function(event) {

                      // skip for arrow keys
                  if(event.which >= 37 && event.which <= 40) return;

                  // format number
                  $(this).val(function(index, value) {
                    return value
                      .replace(/[^0-9-]/g, "")
                    ;
                  });
                });

                $('.invoice_tire_number').keyup(function(){
                    var val = $(this).val();
                    $(this).val(val.substring(1, val.length));

                    var val_new = $(this).val();
                    if (val_new.length<7) {
                        $(this).val("0"+val_new);
                    }
                });
            }
        });

        $("#dialogContent7").dialog({
            draggable:true,
            modal: true,
            autoOpen: false,
            height:300,
            width:"30%",
            
        });

        $( "#dialogContent7" ).dialog( "open" )
    });


//set up the dialog box.
$( "#dialogContent7" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        In: function(){
            var printID = $('#i_order7').val();
            var number = [];
            var date = [];
            var ngay = "";


            $('.invoice_tire_number:last').each(function() { 
                number.push($(this).val());
            });
            $('.invoice_tire_date:last').each(function() { 
                date.push($(this).val());
            });

            ngay = date[0].replace(/-/g,"/");

            if (parseInt(number[0])<1) {
                alert('Vui lòng nhập số hóa đơn');
                $('.invoice_tire_number:last').focus();
            }
            else{
                $("#winpopup").dialog({
                    position: ['center',5],
                    draggable:true,
                    modal: true,
                    autoOpen: false,
                    maxHeight: $(window).height()-50,
                    width:"auto",
                    resizable: false,
                    title:'Hóa đơn GTGT',
                    buttons: [
                    /*{
                        text: "In",
                        icons: { primary: "ui-icon-print" },
                        click: function() {
                            var id = $('#i_order7').val();
                            var invoice_tire = [];
                            var invoice_tire_number = [];
                            var invoice_tire_date = [];

                            $('.invoice_tire_number').each(function() { 
                                invoice_tire_number.push($(this).val());
                            });
                            $('.invoice_tire_date').each(function() { 
                                invoice_tire_date.push($(this).val());
                            });
                            for (var i = 0; i < invoice_tire_number.length; i++) {
                                invoice_tire.push({'invoice_tire_number':invoice_tire_number[i], 'invoice_tire_date':invoice_tire_date[i]});
                            };
                                
                            $.post("<?php echo BASE_URL ?>/ordertire/addordervat", {data: id, invoice_tire: invoice_tire},
                               function(data){
                            }); 

                          $( this ).dialog( "close" );
                          window.open("<?php echo $this->url('ordertire/printpage/') ?>"+printID+"/"+ngay+"/"+number[0]);
                        },
                    },*/
                    {
                        text: "Xem",
                        icons: { primary: "ui-icon-print" },
                        click: function() {
                          $( this ).dialog( "close" );
                          window.open("<?php echo $this->url('ordertire/printhd/') ?>"+printID+"/"+ngay+"/"+number[0]);
                        },
                    },
                    {
                        text: "Tải xuống",
                        icons: { primary: "ui-icon-download" },
                        click: function() {
                          window.location.href="<?php echo BASE_URL.'/ordertire/invoice/' ?>"+printID;
                        },
                    },
                    {
                        text: "Đóng",
                        icons: { primary: "ui-icon-close" },
                        click: function() {
                          $( this ).dialog( "close" );
                        }   
                    }
                    ]

                });
                $("#winpopup").load("<?php echo $this->url('ordertire/printhd/') ?>"+printID+"/"+ngay+"/"+number[0]);
                $("#winpopup").dialog("open");
            }
        },
        <?php if($_SESSION['role_logined']==1){ ?>
        OK: function() {
            var id = $('#i_order7').val();
            
            var invoice_tire = [];

            var invoice_tire_number = [];
            var invoice_tire_date = [];
            

            $('.invoice_tire_number').each(function() { 
                invoice_tire_number.push($(this).val());
            });
            $('.invoice_tire_date').each(function() { 
                invoice_tire_date.push($(this).val());
            });
            for (var i = 0; i < invoice_tire_number.length; i++) {
                invoice_tire.push({'invoice_tire_number':invoice_tire_number[i], 'invoice_tire_date':invoice_tire_date[i]});
                
                
            };
                
                $.post("<?php echo BASE_URL ?>/ordertire/addordervat", {data: id, invoice_tire: invoice_tire},
                   function(data){
                    $("html, body").animate({ scrollTop: 0 }, 100);
                    setTimeout(function() {
                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                      }, 200);
                   
                   }); 
              
            $( this ).dialog( "close" );
        },     
        <?php } ?>   
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});

$(".order_list").click(function(){
        $("#winpopup").dialog({
            draggable:true,
            modal: true,
            autoOpen: false,
            height:"auto",
            width:600,
            resizable: false,
            title:'Thông tin',
            position: ['center',5],
            
        });
        $("#winpopup").load($(this).attr('href'));
        $("#winpopup").dialog("open");
         
        return false;
    });

$(".order_discount").click(function(){
        $("#winpopup").dialog({
            draggable:true,
            modal: true,
            autoOpen: false,
            height:300,
            width:600,
            resizable: false,
            title:'Thông tin',
            
        });
        $("#winpopup").load($(this).attr('href'));
        $("#winpopup").dialog("open");
         
        return false;
    });

$('.edit_tr').hover(function(){
    var order_tire_status = $(this).find("#order_tire_status_"+$(this).attr('id')).attr('data');
    var approve = $(this).find("#approve_"+$(this).attr('id')).attr('data');
    if (order_tire_status != 1) {
        $('#ex_stock_'+$(this).attr('id')).show();
    }
    else{
        $('#ex_stock_'+$(this).attr('id')).hide();
    }

    if (approve >0) {
        $('#approve_btn_'+$(this).attr('id')).show();
    }
    else{
        $('#approve_btn_'+$(this).attr('id')).hide();
    }
},function(){
    $('#ex_stock_'+$(this).attr('id')).hide();
    $('#approve_btn_'+$(this).attr('id')).hide();
});

$('.approve').click(function(){
    var id = $(this).attr("data");
    var r = confirm("Bạn có chắc chắn không?");
      if (r == true){
        $('#loading').html("<img src='<?php echo BASE_URL ?>/public/images/loading.gif'/>").fadeIn(500);
        $.post("<?php echo BASE_URL ?>/ordertire/approve", {data: id},
           function(data){
            //alert(data);

            $("html, body").animate({ scrollTop: 0 }, 100);
            setTimeout(function() {
                                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                                      }, 200);

            $('#loading').fadeOut(500);
           
           }); 
      }

});
$('.approveremove').click(function(){
    var id = $(this).attr("data");
    var r = confirm("Bạn có chắc chắn không?");
      if (r == true){
        $('#loading').html("<img src='<?php echo BASE_URL ?>/public/images/loading.gif'/>").fadeIn(500);
        $.post("<?php echo BASE_URL ?>/ordertire/approveremove", {data: id},
           function(data){
            //alert(data);

            $("html, body").animate({ scrollTop: 0 }, 100);
            setTimeout(function() {
                                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                                      }, 200);

            $('#loading').fadeOut(500);
           
           }); 
      }

});


$('.ex_stock')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        $('#i_lift').val("");
        $('#i_delivery_date').val("<?php echo date('d-m-Y') ?>");
        $('#i_arrival_date').val("<?php echo date('d-m-Y') ?>");
        $('#i_order3').val($(this).attr('data'));
        $("#i_lift").tagit({
          tagSource: function(search, showChoices) {
            $.ajax({
              url: "<?php echo BASE_URL ?>/working/getContributor",
              data: {search: search.term},
              success: function(choices) {
                showChoices(choices);
              }
            });
          }
        });

        $( "#dialogContent3" ).dialog( "open" )
    });


//set up the dialog box.
$( "#dialogContent3" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        OK: function() {
            var id = $('#i_order3').val();
            var lift = $('#i_lift').val().trim();
            var delivery_date = $('#i_delivery_date').val();
            var arrival_date = $('#i_arrival_date').val();
                
                $.post("<?php echo BASE_URL ?>/ordertire/exstock", {data: id, delivery_date: delivery_date,arrival_date: arrival_date, lift: lift},
                   function(data){
                    $("html, body").animate({ scrollTop: 0 }, 100);
                    setTimeout(function() {
                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                      }, 200);
                   
                   }); 
              
            $( this ).dialog( "close" );
        },        
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});

$('.ex_stock_edit')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        
        $('#i_order6').val($(this).attr('data'));
        $('#i_delivery_date6').val($(this).attr('alt'));
        $('#i_arrival_date6').val($(this).attr('title'));

        if ($('#i_lift6').hasClass('tagit-hidden-field')) {
            $('#i_lift6').tagit('destroy');
        }

        $('#i_lift6').val($(this).attr('name').trim());

        $("#i_lift6").tagit({
          tagSource: function(search, showChoices) {
            $.ajax({
              url: "<?php echo BASE_URL ?>/working/getContributor",
              data: {search: search.term},
              success: function(choices) {
                showChoices(choices);
              }
            });
          }
        });

        $( "#dialogContent6" ).dialog( "open" )
    });


//set up the dialog box.
$( "#dialogContent6" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        OK: function() {
            var id = $('#i_order6').val();
            var lift = $('#i_lift6').val().trim();
            var delivery_date = $('#i_delivery_date6').val();
            var arrival_date = $('#i_arrival_date6').val();
                
                $.post("<?php echo BASE_URL ?>/ordertire/exstockedit", {data: id, delivery_date: delivery_date,arrival_date: arrival_date, lift: lift},
                   function(data){
                    $("html, body").animate({ scrollTop: 0 }, 100);
                    setTimeout(function() {
                        sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                      }, 200);
                   
                   }); 
              
            $( this ).dialog( "close" );
        },        
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});

function addRow(tableID){
    var table=document.getElementById(tableID);
    var rowCount=table.rows.length;
    var row=table.insertRow(rowCount);
    var colCount=table.rows[0].cells.length;
    for(var i=0;i<colCount;i++){
        var newcell=row.insertCell(i);
        newcell.innerHTML=table.rows[0].cells[i].innerHTML;
        switch(newcell.childNodes[0].type){
            case"text":newcell.childNodes[0].value="";
            break;
            case"checkbox":newcell.childNodes[0].checked=false;
            break;
            case"select-one":newcell.childNodes[0].selectedIndex=0;
            break;
        }
    }

    $('.vendor:last').attr('disabled',false);
    $('.vendor:last').attr('data','');
    $('.vendor:last').val("");
    $('.order_tire_cost_type:last').attr('disabled',false);
    $('.order_tire_cost:last').val("");
    $('.order_tire_cost:last').attr('disabled',false);
    $('.comment:last').val("");
    $('.comment:last').attr('disabled',false);
    $('input[name="chk"]:last').attr('data',"");
    $('input[name="chk"]:last').attr('tabindex',0);
    $('input[name="chk"]:last').attr('title',"");
    $('input[name="chk"]:last').attr('class',"");
    $('input[name="chk"]:last').attr('disabled',false);
    //$(".vendor:last").val($(".vendor:last option:first").val());
    $(".order_tire_cost_type:last").val($(".order_tire_cost_type:last option:first").val());

 
$('.order_tire_cost_type').change(function(){
    var row = $(this).parent().parent().parent().parent().parent().parent();
    var rowIndex = row[0].rowIndex;

    var check_type = 0;
    var check_vendor = 0;

    var val = $(this).val();
    var vendor_val = $('.vendor:eq('+rowIndex+')').attr('data');
    $('.order_tire_cost_type').each(function() { 
        if (val == $(this).val()) {
            check_type ++;

            var row2 = $(this).parent().parent().parent().parent().parent().parent();
            var rowIndex2 = row2[0].rowIndex;
            var vendor_val2 = $('.vendor:eq('+rowIndex2+')').attr('data');
            if (vendor_val == vendor_val2) {
                check_vendor ++;
            }
        }
    });

    

    if (check_type >= 2 && check_vendor >= 2) {
        alert('Vui lòng chọn loại phí khác cho vendor này!');
        $(".order_tire_cost_type:last").val($(".order_tire_cost_type:last option:first").val());
        //$(".vendor:last").val($(".vendor:last option:first").val());
        $('.vendor:last').attr('data','');
        $('.vendor:last').val("");
        
    };
    
});
$('.vendor').change(function(){
    
    var row = $(this).parent().parent().parent().parent().parent().parent();
    var rowIndex = row[0].rowIndex;

    var check_type = 0;
    var check_vendor = 0;

    var val = $(this).attr('data');
    if (val == "") {
        $(this).val("");
        $(this).focus();
    }
    else{
        var type_val = $('.order_tire_cost_type:eq('+rowIndex+')').val();
        $('.vendor').each(function() { 
            if (val == $(this).attr('data')) {
                check_vendor ++;

                var row2 = $(this).parent().parent().parent().parent().parent().parent();
                var rowIndex2 = row2[0].rowIndex;
                var type_val2 = $('.order_tire_cost_type:eq('+rowIndex2+')').val();
                if (type_val == type_val2) {
                    check_type ++;
                }
            }
        });


        if (check_type >= 2 && check_vendor >= 2) {
            alert('Vui lòng chọn loại phí khác cho vendor này!');
            $(".order_tire_cost_type:last").val($(".order_tire_cost_type:last option:first").val());
            //$(".vendor:last").val($(".vendor:last option:first").val());
            $('.vendor:last').attr('data','');
            $('.vendor:last').val("");
            
        };
    }
    
    
});

function get_number(id){
    return $(id).val().replace(/[^0-9\.-]+/g,"");
}

    $('.numbers').focus(function(){
            if ( $(this).val() == '0') {
               $(this).val(""); 
            };
            
        });
        $('.numbers').blur(function(){
            if ( $(this).val() == "") {
                $(this).val(0);
            };
            
        });

         $('.numbers').keyup(function(event) {

          // skip for arrow keys
      if(event.which >= 37 && event.which <= 40) return;

      // format number
      $(this).val(function(index, value) {
        return value
          .replace(/[^0-9-.]/g, "")
          .replace(/\B(?=(\d{3})+(?!\d))/g, ",")
        ;
      });
    });

    $('html').click(function(e) {
        $('.customer_list_id').slideUp(200);
        $('.vendor').each(function(){
            if ($(this).attr('data')=="") {
                $(this).val("");
            }
        });

    });
    $('.vendor').keyup(function(){
        var row = $(this).parent().parent().parent().parent().parent().parent();
        var rowIndex = row[0].rowIndex;

        var keyword = $(this).val();
        $.ajax({
            url: '<?php echo BASE_URL ?>/ordertire/getvendor',
            type: 'POST',
            data: {keyword:keyword, offset:rowIndex},
            success:function(data){
                $('.customer_list_id:eq('+rowIndex+')').slideDown(200);
                $('.customer_list_id:eq('+rowIndex+')').html(data);
            }
        });
        if ($('.vendor:eq('+rowIndex+')').val() == "" || $('.vendor:eq('+rowIndex+')').attr('data') == "") {
            
            $('.vendor:eq('+rowIndex+')').attr('data',"");
        }

        
    });

    $('.vendor').on('keydown', function() {
        var row = $(this).parent().parent().parent().parent().parent().parent();
        var rowIndex = row[0].rowIndex;

        var key = event.keyCode || event.charCode;

        if( key == 8 || key == 46 ){
            $('.vendor:eq('+rowIndex+')').attr('data',"");
        }
            
      });
    function set_item_other(item,value,vitri) {
        // change input value
        $('.vendor:eq('+vitri+')').val(item);
        $('.vendor:eq('+vitri+')').attr("data",value);
        // hide proposition list
        $('.customer_list_id').hide();
        $('.vendor:eq('+vitri+')').focus();

        var check_type = 0;
        var check_vendor = 0;
        var val = value;
        var type_val = $('.order_tire_cost_type:eq('+vitri+')').val();
            $('.vendor').each(function() { 
                if (val == $(this).attr('data')) {
                    check_vendor ++;

                    var row2 = $(this).parent().parent().parent().parent().parent().parent();
                    var rowIndex2 = row2[0].rowIndex;
                    var type_val2 = $('.order_tire_cost_type:eq('+rowIndex2+')').val();
                    if (type_val == type_val2) {
                        check_type ++;
                    }
                }
            });


            if (check_type >= 2 && check_vendor >= 2) {
                alert('Vui lòng chọn loại phí khác cho vendor này!');
                $(".order_tire_cost_type:last").val($(".order_tire_cost_type:last option:first").val());
                //$(".vendor:last").val($(".vendor:last option:first").val());
                $('.vendor:last').attr('data','');
                $('.vendor:last').val("");
                
            };

    }

}
function deleteRow(tableID){
    try{
        var table=document.getElementById(tableID);
        var rowCount=table.rows.length;

        var r = confirm("Bạn có chắc chắn không?");
        if (r == true){
            for(var i=0;i<rowCount;i++){
                var row=table.rows[i];
                var chkbox=row.cells[0].childNodes[0];
                if(null!=chkbox&&true==chkbox.checked){
                    if(chkbox.getAttribute("title") > 0){
                        
                            var data = chkbox.getAttribute("data");
                            var type = chkbox.getAttribute("tabindex");
                            var vendor = chkbox.className;
                            $.post("<?php echo BASE_URL ?>/ordertire/deleteordercost", {data: data, vendor: vendor, type: type},
                               function(data){
                                //alert(data);
                               }); 
                        
                    }
                    if(rowCount<=1){
                        alert("Cannot delete all the rows.");
                        break;
                    }
                    table.deleteRow(i);
                    rowCount--;
                    i--;
                }
            }
        }
    }
    catch(e){
        alert(e);
    }
}

function addRow2(tableID){
    var table=document.getElementById(tableID);
    var rowCount=table.rows.length;
    var row=table.insertRow(rowCount);
    var colCount=table.rows[0].cells.length;
    for(var i=0;i<colCount;i++){
        var newcell=row.insertCell(i);
        newcell.innerHTML=table.rows[0].cells[i].innerHTML;
        switch(newcell.childNodes[0].type){
            case"text":newcell.childNodes[0].value="";
            break;
            case"checkbox":newcell.childNodes[0].checked=false;
            break;
            case"select-one":newcell.childNodes[0].selectedIndex=0;
            break;
        }
    }

    $('.invoice_tire_number:last').val("0000000");
    $('input[name="chk2"]:last').attr('data',"");
    $('input[name="chk2"]:last').attr('tabindex',0);
    $('input[name="chk2"]:last').attr('title',"");
    $('input[name="chk2"]:last').attr('class',"");
    $('input[name="chk2"]:last').attr('disabled',false);

    $('.number').focus(function(){
        if ( $(this).val() == '0') {
           $(this).val(""); 
        };
        
    });
    $('.number').blur(function(){
        if ( $(this).val() == "") {
            $(this).val(0);
        };
        
    });
    $('.number').keyup(function(event) {

          // skip for arrow keys
      if(event.which >= 37 && event.which <= 40) return;

      // format number
      $(this).val(function(index, value) {
        return value
          .replace(/[^0-9-]/g, "")
        ;
      });
    });

    $('.invoice_tire_number').keyup(function(){
        var val = $(this).val();
        $(this).val(val.substring(1, val.length));

        var val_new = $(this).val();
        if (val_new.length<7) {
            $(this).val("0"+val_new);
        }
    });

}
function deleteRow2(tableID){
    try{
        var table=document.getElementById(tableID);
        var rowCount=table.rows.length;

        var r = confirm("Bạn có chắc chắn không?");
        if (r == true){
            for(var i=0;i<rowCount;i++){
                var row=table.rows[i];
                var chkbox=row.cells[0].childNodes[0];
                if(null!=chkbox&&true==chkbox.checked){
                    if(chkbox.getAttribute("title") > 0){
                        
                            var data = chkbox.getAttribute("data");
                            var number = chkbox.getAttribute("title");
                            $.post("<?php echo BASE_URL ?>/ordertire/deleteordervat", {data: data, number: number},
                               function(data){
                                //alert(data);
                               }); 
                        
                    }
                    if(rowCount<=1){
                        alert("Cannot delete all the rows.");
                        break;
                    }
                    table.deleteRow(i);
                    rowCount--;
                    i--;
                }
            }
        }
    }
    catch(e){
        alert(e);
    }
}

$('.numbers').focus(function(){
            if ( $(this).val() == '0') {
               $(this).val(""); 
            };
            
        });
        $('.numbers').blur(function(){
            if ( $(this).val() == "") {
                $(this).val(0);
            };
            
        });

         $('.numbers').keyup(function(event) {

          // skip for arrow keys
      if(event.which >= 37 && event.which <= 40) return;

      // format number
      $(this).val(function(index, value) {
        return value
          .replace(/[^0-9-.]/g, "")
          .replace(/\B(?=(\d{3})+(?!\d))/g, ",")
        ;
      });
    });

$('.order_tire_cost_type').change(function(){
    var row = $(this).parent().parent().parent().parent().parent().parent();
    var rowIndex = row[0].rowIndex;

    var check_type = 0;
    var check_vendor = 0;

    var val = $(this).val();
    var vendor_val = $('.vendor:eq('+rowIndex+')').attr('data');
    $('.order_tire_cost_type').each(function() { 
        if (val == $(this).val()) {
            check_type ++;

            var row2 = $(this).parent().parent().parent().parent().parent().parent();
            var rowIndex2 = row2[0].rowIndex;
            var vendor_val2 = $('.vendor:eq('+rowIndex2+')').attr('data');
            if (vendor_val == vendor_val2) {
                check_vendor ++;
            }
        }
    });

    

    if (check_type >= 2 && check_vendor >= 2) {
        alert('Vui lòng chọn loại phí khác cho vendor này!');
        $(".order_tire_cost_type:last").val($(".order_tire_cost_type:last option:first").val());
        //$(".vendor:last").val($(".vendor:last option:first").val());
        $('.vendor:last').attr('data','');
        $('.vendor:last').val("");
        
    };
    
});
$('.vendor').change(function(){
    var row = $(this).parent().parent().parent().parent().parent().parent();
    var rowIndex = row[0].rowIndex;

    var check_type = 0;
    var check_vendor = 0;

    var val = $(this).attr('data');
    if (val == "") {
        $(this).val("");
        $(this).focus();
    }
    else{
        var type_val = $('.order_tire_cost_type:eq('+rowIndex+')').val();
        $('.vendor').each(function() { 
            if (val == $(this).attr('data')) {
                check_vendor ++;

                var row2 = $(this).parent().parent().parent().parent().parent().parent();
                var rowIndex2 = row2[0].rowIndex;
                var type_val2 = $('.order_tire_cost_type:eq('+rowIndex2+')').val();
                if (type_val == type_val2) {
                    check_type ++;
                }
            }
        });


        if (check_type >= 2 && check_vendor >= 2) {
            alert('Vui lòng chọn loại phí khác cho vendor này!');
            $(".order_tire_cost_type:last").val($(".order_tire_cost_type:last option:first").val());
            //$(".vendor:last").val($(".vendor:last option:first").val());
            $('.vendor:last').attr('data','');
            $('.vendor:last').val("");
            
        };
        
    }
    
});

var pickerOpay2 = {
        closeText: "Đóng",
        currentText: "Hiện tại",
        nextText: "Tiếp",
        prevText: "Quay lại",
        monthNames: ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6", "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"],
        monthNamesShort: ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6", "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"],
        dayNames: ["Chủ nhật", "Thứ hai", "Thứ ba", "Thứ tư", "Thứ năm", "Thứ sáu", "Thứ bảy"],
        dayNamesShort: ["CN", "T2", "T3", "T4", "T5", "T6", "T7"],
        dayNamesMin: ["CN", "T2", "T3", "T4", "T5", "T6", "T7"],
        dateFormat: 'dd-mm-yy',
        changeMonth: true,
        changeYear: true,
        yearRange: "-100:+0",
        firstDay: 1,
        isRTL: false,
        showButtonPanel: true
    }; 
    $(".ngay").datepicker(pickerOpay2);

$('.editButton')
    //.button({ icons: { primary: "ui-icon-document" }})
    .click(function() {
        if ($(this).attr('value')==1) {
            $('#contract_link').val("contract");
        }
        else{
            $('#contract_link').val("contractcm");
        }

        $('#contract_customer').val($(this).attr('data'));

        $( "#dialogContent4" ).dialog( "open" )
    });


//set up the dialog box.
$( "#dialogContent4" ).dialog({
    autoOpen: false,
    modal: true,
    buttons: {
        OK: function() {
            var customer = $('#contract_customer').val();
            var date = $('#contract_date').val();
            var number = $('#contract_number').val();
            var pay = $('#contract_pay').val();
            var pay2 = $('#contract_pay2').val();
            var valid = $('#contract_valid').val();
            var link = $('#contract_link').val();
            
            
            number = number.replace(/ /g,"$");

            $("#winpopup").dialog({
                draggable:true,
                modal: true,
                autoOpen: false,
                width: "90%",
                height: 600,
                resizable: false,
                title:'Chi tiết',
                buttons: {
                    OK: function() {
                        window.location.href = "<?php echo BASE_URL ?>/ordertire/"+link+"/"+customer+"/0/0/0/"+date+"@"+number+"@"+pay+"@"+pay2+"@"+valid;
                    },
                    Cancel: function() {
                        $( this ).dialog( "close" );
                    }
                }
            });
            $("#winpopup").load("<?php echo BASE_URL ?>/ordertire/"+link+"/"+customer+"/0/0/0/"+date+"@"+number+"@"+pay+"@"+pay2+"@"+valid);
            $("#winpopup").dialog("open");
            
            //     $.post("<?php echo BASE_URL ?>/marketing/contract", {customer: customer, from: from, to: to,date: date, number: number, pay: pay, valid: valid},
            //       function(data){
                        
            //        });  
              
            // $( this ).dialog( "close" );
        },        
        Cancel: function() {
            $( this ).dialog( "close" );
        }
    }
});

</script>
<script type="text/javascript">
    
    $('#sl_tha').change(function(){
        var m = $(this).val();
        var y = $('#sl_na').val();
        var firstDay = new Date(y, m-1, 1);
        var lastDay = new Date(y, m, 0);

        $('#batdau').datepicker("setDate", firstDay );
        $('#ketthuc').datepicker("setDate", lastDay );

    });

    $('#sl_na').change(function(){
        var y = $(this).val();
        var m = $('#sl_tha').val();
        var firstDay = new Date(y, m-1, 1);
        var lastDay = new Date(y, m, 0);

        $('#batdau').datepicker("setDate", firstDay );
        $('#ketthuc').datepicker("setDate", lastDay );

    });


    var pickerOpts = {
        closeText: "Đóng",
        currentText: "Hiện tại",
        nextText: "Tiếp",
        prevText: "Quay lại",
        monthNames: ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6",
        "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"],
        monthNamesShort: ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6",
        "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"],
        dayNames: ["Chủ nhật", "Thứ hai", "Thứ ba", "Thứ tư", "Thứ năm",
        "Thứ sáu", "Thứ bảy"],
        dayNamesShort: ["CN", "T2", "T3", "T4", "T5",
        "T6", "T7"],
        dayNamesMin: ["CN", "T2", "T3", "T4", "T5",
        "T6", "T7"],
        //defaultDate: "+1w",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy',
        firstDay: 1,
        isRTL: false,
        showWeek: true,
        weekHeader: 'Tuần',
        showButtonPanel: true,
        onClose: function(selectedDate) {
                
                $( "#ketthuc" ).datepicker( "option", "minDate", selectedDate );

         },
         
    };  
    $("#batdau").datepicker(pickerOpts);

    var pickerOpts4 = {
        closeText: "Đóng",
        currentText: "Hiện tại",
        nextText: "Tiếp",
        prevText: "Quay lại",
        monthNames: ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6",
        "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"],
        monthNamesShort: ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6",
        "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"],
        dayNames: ["Chủ nhật", "Thứ hai", "Thứ ba", "Thứ tư", "Thứ năm",
        "Thứ sáu", "Thứ bảy"],
        dayNamesShort: ["CN", "T2", "T3", "T4", "T5",
        "T6", "T7"],
        dayNamesMin: ["CN", "T2", "T3", "T4", "T5",
        "T6", "T7"],
        //defaultDate: "+1w",
        changeMonth: true,
        changeYear: true,
        dateFormat: 'dd-mm-yy',
        firstDay: 1,
        isRTL: false,
        showWeek: true,
        weekHeader: 'Tuần',
        showButtonPanel: true,
        onClose: function(selectedDate) {
                
                $( "#batdau" ).datepicker( "option", "maxDate", selectedDate );
                
         },
         
    };  
    $("#ketthuc").datepicker(pickerOpts4);
              
            
  $('.del').click(function(){
    var data = $(this).attr('data');
    var r = confirm("Bạn có chắc chắn không?");
    if (r == true){
         $.post("<?php echo BASE_URL ?>/ordertire/delete", {data: data},
           function(data){
            //console.log(data);
                setTimeout(function() {
                    sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                  }, 200);
           }); 
    }
});

  $('.revert').click(function(){
    var data = $(this).attr('data');
    var r = confirm("Bạn có chắc chắn không?");
    if (r == true){
         $.post("<?php echo BASE_URL ?>/ordertire/revert", {data: data},
           function(data){
                setTimeout(function() {
                    sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                  }, 200);
           }); 
    }
});

  $('.unlock').click(function(){
    var data = $(this).attr('data');
    var val = $(this).val();
    var r = confirm("Bạn có chắc chắn không?");
    if (r == true){
         $.post("<?php echo BASE_URL ?>/ordertire/unlock", {data: data, val: val},
           function(data){
                setTimeout(function() {
                    sapxep('<?php echo $page ?>','<?php echo $order_by ?>','<?php echo $order ?>');
                  }, 200);
           }); 
    }
});

function action2(){
  
    var action       = $('#action').attr('value');
    if(action != -1)
    {
      if($('.add-field') !== null)
        {
          $('.add-field').fadeOut();
        }
      var del = [];
      ids = $('input:checkbox.checkbox:checked').map(function() { return del.push(this.value); });
      
       if(action=='delete'){
         var r = confirm("Bạn có chắc chắn muốn xóa không?");
        if (r == true){
          $('#loading').html("<img src='public/images/loading.gif'/>").fadeIn(500);
           $.ajax({
            url: "<?php echo $this->url('ordertire/delete') ?>",   
            type: 'POST',   
            data: "xoa="+del,   
            success:function(answer){ 
              for(var i=0; i<del.length; i++)
                 $('tr#'+del[i]).remove();
              $('#loading').fadeOut(500); 
              $("html, body").animate({ scrollTop: 0 }, 100);
            }
          });
        }
       }
       else if(action=='phathanh'){
         $.ajax({
          url: window.location.href+"/update", 
          type: 'POST',   
          data: "phathanh="+del,   
          success:function(answer){ 
            for(var i=0; i<del.length; i++)
               $('#trangthai_'+del[i]).html('Hiá»ƒn thá»‹');
            $('#loading').fadeOut(500); 
          }
        });
       }
       else if(action=='an'){
         $.ajax({
          url: window.location.href+"/update",   
          type: 'POST',   
          data: "an="+del,   
          success:function(answer){ 
            for(var i=0; i<del.length; i++)
               $('#trangthai_'+del[i]).html('áº¨n');
            $('#loading').fadeOut(500); 
          }
        });
       }
       else if(action=='noibat'){
         $.ajax({
          url: window.location.href+"/update",  
          type: 'POST',   
          data: "noibat="+del,   
          success:function(answer){ 
            for(var i=0; i<del.length; i++)
               $('#tinnoibat_'+del[i]).html('Ná»•i báº­t');
            $('#loading').fadeOut(500); 
          }
        });
       }
       else if(action=='binhthuong'){
         $.ajax({
          url: window.location.href+"/update",   
          type: 'POST',   
          data: "binhthuong="+del,   
          success:function(answer){ 
            for(var i=0; i<del.length; i++)
               $('#tinnoibat_'+del[i]).html('BĂ¬nh thÆ°á»ng');
            $('#loading').fadeOut(500); 
          }
        });
       }
    }
  
}

$('html').click(function(e) {
    $('.customer_list_id').slideUp(200);
    $('.vendor').each(function(){
        if ($(this).attr('data')=="") {
            $(this).val("");
        }
    });

});
$('.vendor').keyup(function(){
    var row = $(this).parent().parent().parent().parent().parent().parent();
    var rowIndex = row[0].rowIndex;

    var keyword = $(this).val();
    $.ajax({
        url: '<?php echo BASE_URL ?>/ordertire/getvendor',
        type: 'POST',
        data: {keyword:keyword, offset:rowIndex},
        success:function(data){
            $('.customer_list_id:eq('+rowIndex+')').slideDown(200);
            $('.customer_list_id:eq('+rowIndex+')').html(data);
        }
    });
    if ($('.vendor:eq('+rowIndex+')').val() == "" || $('.vendor:eq('+rowIndex+')').attr('data') == "") {
        
        $('.vendor:eq('+rowIndex+')').attr('data',"");
    }

    
});

$('.vendor').on('keydown', function() {
    var row = $(this).parent().parent().parent().parent().parent().parent();
    var rowIndex = row[0].rowIndex;

    var key = event.keyCode || event.charCode;

    if( key == 8 || key == 46 ){
        $('.vendor:eq('+rowIndex+')').attr('data',"");
    }
        
  });
function set_item_other(item,value,vitri) {
    // change input value
    $('.vendor:eq('+vitri+')').val(item);
    $('.vendor:eq('+vitri+')').attr("data",value);
    // hide proposition list
    $('.customer_list_id').hide();
    $('.vendor:eq('+vitri+')').focus();

    var check_type = 0;
    var check_vendor = 0;
    var val = value;
    var type_val = $('.order_tire_cost_type:eq('+vitri+')').val();
        $('.vendor').each(function() { 
            if (val == $(this).attr('data')) {
                check_vendor ++;

                var row2 = $(this).parent().parent().parent().parent().parent().parent();
                var rowIndex2 = row2[0].rowIndex;
                var type_val2 = $('.order_tire_cost_type:eq('+rowIndex2+')').val();
                if (type_val == type_val2) {
                    check_type ++;
                }
            }
        });


        if (check_type >= 2 && check_vendor >= 2) {
            alert('Vui lòng chọn loại phí khác cho vendor này!');
            $(".order_tire_cost_type:last").val($(".order_tire_cost_type:last option:first").val());
            //$(".vendor:last").val($(".vendor:last option:first").val());
            $('.vendor:last').attr('data','');
            $('.vendor:last').val("");
            
        };
}

$(".customer").click(function(){
        $("#winpopup").dialog({
            draggable:true,
            modal: true,
            autoOpen: false,
            height:500,
            width:"90%",
            resizable: false,
            title:'Danh sách đơn hàng',
            
        });
        $("#winpopup").load($(this).attr('href'));
        $("#winpopup").dialog("open");
         
        return false;
    });

$( "#hoanthanh" ).dialog({

    autoOpen: false,

    modal: true,

    width: "auto",

    maxHeight: $(window).height()-50,

    title: "Thông báo",

    hide: 'fold',

    show: 'blind',

    buttons: [

    {

        text: "In đơn hàng",
        icons: { primary: "ui-icon-print" },

        click: function() {

          $( this ).dialog( "close" );

          var lastID = $('#lastID').val();

          window.open("<?php echo $this->url('ordertire/printview/') ?>"+lastID);

        },
    },
    {

        text: "In đơn hàng (0 giá)",
        icons: { primary: "ui-icon-print" },

        click: function() {

          $( this ).dialog( "close" );

          var lastID = $('#lastID').val();

          window.open("<?php echo $this->url('ordertire/printview2/') ?>"+lastID);

        },
    },
    {
        text: "Tải xuống",
        icons: { primary: "ui-icon-disk" },
        click: function() {

          $( this ).dialog( "close" );

          var lastID = $('#lastID').val();

          window.location.href = "<?php echo $this->url('ordertire/bienban/') ?>"+lastID;

        }       


    }
    ]

});
$('.bienban').click(function(){
    $('#lastID').val($(this).attr('data'));
    $('#hoanthanh').dialog('open');
});


$(document).ready(function() {
// Tooltip only Text
$('.masterTooltip').hover(function(){
        // Hover over code
        var title = $(this).attr('title');
        $(this).data('tipText', title).removeAttr('title');
        if (title != "") {
            $('<p class="showtooltip"></p>')
            .text(title)
            .appendTo('body')
            .fadeIn('slow');
        }
        
}, function() {
        // Hover out code
        $(this).attr('title', $(this).data('tipText'));
        $('.showtooltip').remove();
}).mousemove(function(e) {
        var mousex = e.pageX - 100; //Get X coordinates
        var mousey = e.pageY + 20; //Get Y coordinates
        $('.showtooltip')
        .css({ top: mousey, left: mousex })
});


});
</script>

<style type="text/css">
.hide_div{
    display: none;
}
.edit_tr:hover .hide_div{
    display: block;
}
.showtooltip {
    display:none;
    position:absolute;
    border:1px solid #333;
    background-color:#161616;
    border-radius:5px;
    padding:10px;
    color:#fff;
    font-size:12px Arial;
}
</style>